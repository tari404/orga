(function(t){function e(e){for(var r,o,s=e[0],u=e[1],c=e[2],l=0,f=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);d&&d(e);while(f.length)f.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,s=1;s<n.length;s++){var u=n[s];0!==a[u]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={app:0},i=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=u;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0e20":function(t,e,n){},2101:function(t,e,n){"use strict";n("8b3f")},"21a6":function(t,e,n){},4765:function(t,e,n){"use strict";n("21a6")},"4fc1":function(t,e,n){},"54b1":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view"),t.needToSetGoal?n("div",{attrs:{id:"orga-setgoal"}},[n("div",[n("p",[t._v("设置目标")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.inputGoal,expression:"inputGoal"}],attrs:{type:"number"},domProps:{value:t.inputGoal},on:{input:function(e){e.target.composing||(t.inputGoal=e.target.value)}}}),n("div",{on:{click:t.confirm}},[t._v("确认")])])]):t._e()],1)},i=[],o=n("1da1"),s=n("5530"),u=(n("a9e3"),n("96cf"),n("2f62")),c={data:function(){return{needToSetGoal:!1,inputGoal:"0"}},computed:Object(s["a"])({},Object(u["b"])(["db"])),created:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("OPEN_DB");case 2:return e.next=4,t.db.get("states","goal");case 4:n=e.sent,"number"!==typeof n&&(t.needToSetGoal=!0);case 6:case"end":return e.stop()}}),e)})))()},methods:{confirm:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=Number(t.inputGoal),e.next=3,t.db.set("states",n,"goal");case 3:t.needToSetGoal=!1;case 4:case"end":return e.stop()}}),e)})))()}}},d=c,l=(n("7faf"),n("2877")),f=Object(l["a"])(d,a,i,!1,null,null,null),p=f.exports,h=n("8c4f"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"orga-home"}},[n("Main",{scopedSlots:t._u([{key:"menu",fn:function(){return[n("SelectDate",{on:{update:t.selectDate}}),n("i",{staticClass:"show-monthly",on:{click:function(e){t.showCalendar=!0}}})]},proxy:!0}])}),n("transition",{attrs:{name:"slide-right"}},[t.showCalendar?n("Monthly",{on:{close:function(e){t.showCalendar=!1}}}):t._e()],1)],1)},v=[],g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("div",{staticClass:"orga-top"},[n("div",[n("Now"),n("div",{staticClass:"orga-console"},[n("div",[n("div",{staticClass:"item"},[t._v(" 本月已攒："),n("span",[t._v(t._s(t.monthly.grow))])]),n("div",{staticClass:"item"},[n("p",[t._v(" 今日增加："),n("span",[t._v(t._s(t.diary.rewards))])]),t.isEmpty?t._e():n("p",[t._v(" 目标："),n("span",[t._v(t._s(t.diary.goal))])])])])])],1),n("div",{staticClass:"orga-menu"},[t._t("menu")],2)]),n("div",{staticClass:"orga-aim"},[n("div",{staticClass:"title"},[n("p",[t._v("今日目标")]),t.diary.targets.length?n("span",{on:{click:t.addDiary}},[t._v("编辑")]):t._e()]),n("div",{staticClass:"diary-container"},[t.isEmpty?n("div",{staticClass:"add-diary",on:{click:t.addDiary}},[t._v("添加目标")]):n("ul",t._l(t.diary.targets,(function(e,r){return n("Target",{key:r,attrs:{content:e.content,finished:e.finished},on:{select:function(e){return t.toggleTarget(r,e)}}})})),1),n("div",{staticClass:"remarks"},[t._v(t._s(t.diary.remarks))]),t.diary.delay?n("div",{staticClass:"orga-overtime"},[t._v("过期弥补")]):t._e()])]),n("div",{staticClass:"orga-footer"},[n("div",{staticClass:"rewards"},[n("div",[n("p",[t._v("今日零花钱")]),n("Reward",{attrs:{diary:t.diary,rewards:t.rewards},on:{"update:rewards":[function(e){t.rewards=e},t.submitDiary]}})],1)]),t.ts?t._e():n("div",[t.tomorrow.targets.length?n("div",[t._v("明日目标已安排")]):n("div",{on:{click:t.addTomorrow}},[t._v("设定明日目标")])]),n("i",{staticClass:"shopping",on:{click:t.goShopping}})]),t.toUpdate?n("UpdateDiary",{attrs:{date:t.toUpdate.date,diary:t.toUpdate},on:{close:t.updateFinished}}):t._e(),t.shopping?n("Shopping",{attrs:{monthly:t.shopping},on:{close:t.shoppingFinished,update:t.updateMonthly}}):t._e()],1)},b=[],w={dateWithoutTimezone:function(t){var e=t?new Date(t):new Date;return e=new Date(e.getTime()-6e4*e.getTimezoneOffset()),e},fromISODate:function(t){var e=new Date(t);return e.getTime()},dateOf:function(t){var e=this.dateWithoutTimezone(t);return{date:Math.floor(e.getTime()/864e5),dateStr:e.toISOString().substr(0,10)}},dateToString:function(t){return new Date(864e5*t).toISOString().substr(0,10)},monthOf:function(t){var e=t?new Date(t):new Date;return 12*(e.getFullYear()-1900)+e.getMonth()},firstDateOfMonth:function(t){var e=t?new Date(t):new Date;return this.dateOf(new Date(e.getFullYear(),e.getMonth(),1).getTime())},lastDateOfMonth:function(t){var e=t?new Date(t):new Date;return this.dateOf(new Date(e.getFullYear(),e.getMonth()+1,0).getTime())}},y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"now"},[n("p",[t._v("当前时间:")]),n("p",[t._v(t._s(this.date.join(" ")))])])},O=[],_=(n("ac1f"),n("5319"),{name:"Now",data:function(){return{date:[],raf:0}},created:function(){this.render()},beforeDestroy:function(){cancelAnimationFrame(this.raf)},methods:{render:function(){var t=w.dateWithoutTimezone(),e=t.toISOString();this.date=[e.substr(0,10).replace(/-/g,"/"),e.substr(11,12)],this.raf=requestAnimationFrame(this.render)}}}),k=_,j=Object(l["a"])(k,y,O,!1,null,null,null),D=j.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"update-diary"},[n("div",{staticClass:"container"},[n("h2",[t._v("更新目标")]),n("p",[t._v("备注")]),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.remarks,expression:"remarks"}],attrs:{rows:"6"},domProps:{value:t.remarks},on:{input:function(e){e.target.composing||(t.remarks=e.target.value)}}}),n("p",[t._v("目标")]),n("div",{staticClass:"aims"},[n("ul",t._l(t.targets,(function(e,r){return n("li",{key:r},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.targets[r],expression:"targets[i]"}],attrs:{rows:"2"},domProps:{value:t.targets[r]},on:{input:function(e){e.target.composing||t.$set(t.targets,r,e.target.value)}}}),n("span",{on:{click:function(e){return t.removeTarget(r)}}},[t._v("X")])])})),0),n("div",{on:{click:t.addTargets}},[t._v("添加")])])]),n("div",{staticClass:"buttons"},[n("div",{on:{click:function(e){return t.$emit("close")}}},[t._v("取消")]),n("div",{on:{click:t.submit}},[t._v("提交")])])])},R=[],S=(n("d81d"),n("a434"),n("4de4"),n("7db0"),{name:"UpdateDiary",props:{date:{type:Number,default:0},diary:{type:Object,default:function(){return null}}},data:function(){var t=[""];return this.diary&&this.diary.targets&&this.diary.targets.length&&(t=this.diary.targets.map((function(t){return t.content}))),{targets:t,remarks:this.diary&&this.diary.remarks||""}},computed:Object(s["a"])({},Object(u["b"])(["db"])),methods:{addTargets:function(t){setTimeout((function(){t.target.scrollIntoView({behavior:"smooth"})})),this.targets.push("")},removeTarget:function(t){this.targets.splice(t,1)},submit:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n,r,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.diary,r=w.dateOf().date,a=0===n.targets.length&&!n.remarks,e.next=5,t.db.get("states","goal");case 5:return i=e.sent,e.next=8,t.db.set("diary",Object(s["a"])(Object(s["a"])({},n),{},{targets:t.targets.filter((function(t){return!!t})).map((function(t){var e=n.targets.find((function(e){return e.content===t}));return{content:t,finished:!!e&&e.finished}})),remarks:t.remarks,goal:i,delay:n.delay||a&&n.date<=r,rewards:n.rewards||0,updated:!1}));case 8:t.$emit("close",!0);case 9:case"end":return e.stop()}}),e)})))()}}}),C=S,M=(n("c064"),Object(l["a"])(C,x,R,!1,null,"b1197122",null)),T=M.exports,P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"update-diary"},[n("div",{staticClass:"container"},[n("h2",[t._v("添加支出")]),n("p",[t._v("开销内容")]),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{rows:"3"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}}),n("p",[t._v("费用")]),n("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],attrs:{type:"number",placeholder:"0"},domProps:{value:t.value},on:{input:function(e){e.target.composing||(t.value=e.target.value)}}}),n("p",{staticClass:"total-spend"},[t._v("本月已花费"+t._s(t.spend.length)+"笔，共支出"+t._s(t.totalValue))]),n("ul",{staticClass:"spend-list"},t._l(t.spend,(function(e,r){return n("li",{key:e.key,on:{click:function(e){return t.toggle(r)}}},[n("i"),n("div",{staticClass:"content"},[n("p",[t._v(t._s(e.content))])]),n("span",[t._v(t._s(e.value))]),n("div",{staticClass:"remove",attrs:{open:t.focus===r}},[n("div",{on:{click:function(e){return e.stopPropagation(),t.remove(r)}}},[t._v("删除")])])])})),0)]),n("div",{staticClass:"buttons"},[n("div",{on:{click:function(e){return t.$emit("close")}}},[t._v("取消")]),n("div",{on:{click:t.submit}},[t._v("提交")])])])},$=[],N=n("2909"),E=(n("99af"),{name:"Shopping",props:{monthly:{type:Object,default:function(){return null}}},data:function(){var t=this.monthly.spend.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{key:Math.round(1e10*Math.random())})})),e=t.reduce((function(t,e){return t+e.value}),0);return{spend:t,totalValue:e,grow:this.monthly.grow,content:"",value:"",focus:-1}},computed:Object(s["a"])({},Object(u["b"])(["db"])),methods:{toggle:function(t){this.focus===t?this.focus=-1:this.focus=t},remove:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.focus=-1,r=e.spend.splice(t,1)[0],a=r.value,e.grow+=a,e.totalValue-=a,n.next=7,e.db.set("monthly",Object(s["a"])(Object(s["a"])({},e.monthly),{},{grow:e.grow,spend:e.spend.map((function(t){return{content:t.content,value:t.value}}))}));case 7:e.$emit("update");case 8:case"end":return n.stop()}}),n)})))()},submit:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=Number(t.value),n&&!(n<0)&&t.content){e.next=3;break}return e.abrupt("return");case 3:return t.grow-=n,e.next=6,t.db.set("monthly",Object(s["a"])(Object(s["a"])({},t.monthly),{},{grow:t.grow,spend:[].concat(Object(N["a"])(t.spend.map((function(t){return{content:t.content,value:t.value}}))),[{content:t.content,value:n}])}));case 6:t.$emit("close",!0);case 7:case"end":return e.stop()}}),e)})))()}}}),B=E,I=(n("4765"),Object(l["a"])(B,P,$,!1,null,"03eb60fc",null)),F=I.exports,U=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{staticClass:"orga-target"},[n("i"),n("span",[t._v(t._s(t.content))]),n("div",{staticClass:"checkbox",attrs:{selected:t.finished},on:{click:t.onSelect}})])},G=[],Y={name:"Target",props:{content:{type:String,default:""},finished:{type:Boolean,default:!1}},methods:{onSelect:function(){this.$emit("select",!this.finished)}}},A=Y,z=(n("7240"),Object(l["a"])(A,U,G,!1,null,"faad8e8a",null)),V=z.exports,K=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"orga-input-reward"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.inputRewards,expression:"inputRewards"}],attrs:{type:"range",min:t.min,max:t.max,step:"1"},domProps:{value:t.inputRewards},on:{change:t.update,__r:function(e){t.inputRewards=e.target.value}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.inputRewards,expression:"inputRewards"}],attrs:{type:"number"},domProps:{value:t.inputRewards},on:{change:t.update,input:function(e){e.target.composing||(t.inputRewards=e.target.value)}}}),t.isEmpty?n("div",{staticClass:"mask"}):t._e()])},W=[],q=(n("d3b7"),n("25f0"),{name:"Reward",props:{rewards:{type:Number,default:0},diary:{type:Object,default:function(){return{goal:100,delay:!1}}}},data:function(){return{inputRewards:this.rewards.toString()}},computed:{min:function(){return 10*-Math.round(this.diary.goal/30)},max:function(){var t=this.diary.goal;return this.diary.delay&&(t/=2),10*Math.round(.15*t)},isEmpty:function(){return 0===this.diary.targets.length&&!this.diary.remarks}},watch:{rewards:function(t){t!==Number(this.inputRewards)&&(this.inputRewards=t.toString())}},methods:{update:function(){this.$emit("update:rewards",Number(this.inputRewards)||0)}}}),H=q,J=(n("eec8"),Object(l["a"])(H,K,W,!1,null,"5901f168",null)),X=J.exports,L={name:"Main",components:{Now:D,UpdateDiary:T,Shopping:F,Target:V,Reward:X},props:{ts:{type:Number,default:void 0}},data:function(){var t=w.dateOf(this.ts),e=w.dateOf(this.ts||Date.now()+864e5),n=w.monthOf(this.ts);return{diary:Object(s["a"])(Object(s["a"])({},t),{},{targets:[],remarks:"",rewards:0}),tomorrow:Object(s["a"])(Object(s["a"])({},e),{},{targets:[],remarks:""}),monthly:{month:n,grow:0,spend:[]},toUpdate:null,shopping:null,rewards:0}},computed:Object(s["a"])(Object(s["a"])({},Object(u["b"])(["db"])),{},{finishedCount:function(){return this.diary.targets.reduce((function(t,e){return t+(e.finished?1:0)}),0)},targetsCount:function(){return this.diary.targets.length},isEmpty:function(){return 0===this.diary.targets.length&&!this.diary.remarks}}),watch:{diary:function(t){this.rewards=t.rewards}},created:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("OPEN_DB");case 2:t.updateDiary(),t.updateMonthly();case 4:case"end":return e.stop()}}),e)})))()},methods:{updateDiary:function(){var t=this;this.db.get("diary",this.diary.date).then((function(e){e&&(t.diary=e)})),this.db.get("diary",this.tomorrow.date).then((function(e){e&&(t.tomorrow=e)}))},updateMonthly:function(){var t=this;this.db.get("monthly",this.monthly.month).then((function(e){e?(t.monthly=e,t.checkMonthly()):t.db.add("monthly",t.monthly)}))},checkMonthly:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.db.getTotalRewards(t.ts);case 2:if(n=e.sent,r=t.monthly.spend.reduce((function(t,e){return t+(e.value||0)}),0),n-r===t.monthly.grow){e.next=7;break}return t.monthly.grow=n-r,e.abrupt("return",t.db.set("monthly",Object(s["a"])({},t.monthly)));case 7:case"end":return e.stop()}}),e)})))()},submitDiary:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.db.set("monthly",Object(s["a"])(Object(s["a"])({},t.monthly),{},{grow:t.monthly.grow-t.diary.rewards+t.rewards}));case 2:return e.next=4,t.db.set("diary",Object(s["a"])(Object(s["a"])({},t.diary),{},{updated:!0,rewards:t.rewards}));case 4:t.updateDiary(),t.updateMonthly();case 6:case"end":return e.stop()}}),e)})))()},addDiary:function(){this.toUpdate=this.diary},addTomorrow:function(){this.toUpdate=this.tomorrow},goShopping:function(){this.shopping=this.monthly},toggleTarget:function(t,e){var n=this.finishedCount;this.diary.targets[t].finished=e;var r=this.diary.goal;this.diary.delay&&(r/=2);var a=this.rewards;if(e){var i=a+(r-a)/(this.targetsCount-n);this.rewards=Math.ceil(i)}else{var o=a-a/n;this.rewards=Math.ceil(o)}this.submitDiary()},updateFinished:function(t){t&&this.updateDiary(),this.toUpdate=null},shoppingFinished:function(t){t&&this.updateMonthly(),this.shopping=null}}},Q=L,Z=(n("6057"),Object(l["a"])(Q,g,b,!1,null,"f744a106",null)),tt=Z.exports,et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"orga-monthly"}},[n("div",{staticClass:"title"},[n("h2",[t._v("日历")]),n("span",{on:{click:function(e){return t.$emit("close")}}},[t._v("BACK")])]),n("div",{staticClass:"calendar-layout"},[n("div",{staticClass:"calendar"},[n("ul",{staticClass:"week"},t._l(t.week,(function(e,r){return n("li",{key:r},[t._v(t._s(e))])})),0),n("ul",[t._l(t.dayOfFirstDate,(function(t){return n("span",{key:t})})),t._l(t.calendar,(function(e,r){return n("li",{key:e.date,staticClass:"day",class:{feature:e.date>=t.today,today:e.date===t.today}},[t._v(" "+t._s(r+1)+" "),n("i",{class:{delay:e.delay},style:{transform:"translateY("+t.dY(e)+")"}})])}))],2)])]),n("div",{staticClass:"month"},[n("span",{on:{click:function(e){return t.jumpMonth(-1)}}},[t._v("<")]),n("p",[t._v(t._s(t.month))]),n("span",{on:{click:function(e){return t.jumpMonth(1)}}},[t._v(">")])]),n("div",{staticClass:"details"})])},nt=[],rt=["日","一","二","三","四","五","六"],at={name:"Monthly",data:function(){return{week:rt,today:w.dateOf().date,timePointer:null,month:"",dayOfFirstDate:0,calendar:[]}},computed:Object(s["a"])({},Object(u["b"])(["db"])),created:function(){this.update()},methods:{dY:function(t){if(t.isEmpty)return"0";var e=-t.rewards/t.goal*100;return e<-100&&(e=-100),e.toString()+"%"},update:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var r,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=w.firstDateOfMonth(t),e.timePointer=r,e.month=r.dateStr.substr(0,7).replace("-","/"),a=new Date(r.dateStr).getDay(),e.dayOfFirstDate=a,n.next=7,e.db.getMonthlyInfo(t);case 7:i=n.sent,e.calendar=i;case 9:case"end":return n.stop()}}),n)})))()},jumpMonth:function(t){var e=new Date(this.timePointer.dateStr),n=new Date(e.getFullYear(),e.getMonth()+t);this.update(n.getTime())}}},it=at,ot=(n("2101"),Object(l["a"])(it,et,nt,!1,null,null,null)),st=ot.exports,ut=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"orga-select-date"},[n("i",{on:{click:t.selectDate}}),n("input",{directives:[{name:"model",rawName:"v-model",value:t.date,expression:"date"}],attrs:{type:"date"},domProps:{value:t.date},on:{input:function(e){e.target.composing||(t.date=e.target.value)}}})])},ct=[],dt={name:"SelectDate",data:function(){var t=w.dateOf().dateStr;return{today:t,date:t}},watch:{date:function(t){t&&t!==this.today&&this.$emit("update",t)}},methods:{selectDate:function(){var t=this.$el.querySelector("input");t.focus({preventScroll:!0})}}},lt=dt,ft=(n("62c8"),Object(l["a"])(lt,ut,ct,!1,null,"17cca89d",null)),pt=ft.exports,ht={name:"Home",components:{Main:tt,Monthly:st,SelectDate:pt},data:function(){return{showCalendar:!1}},created:function(){var t=this;window.orgatest=function(){t.showCalendar=!t.showCalendar}},methods:{selectDate:function(t){this.$router.push("/"+t)}}},mt=ht,vt=(n("c219"),Object(l["a"])(mt,m,v,!1,null,null,null)),gt=vt.exports,bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.refresh?n("Main",{attrs:{ts:t.ts},scopedSlots:t._u([{key:"menu",fn:function(){return[n("router-link",{staticClass:"back-to-home",attrs:{to:"/"}})]},proxy:!0}],null,!1,155912026)}):t._e()},wt=[],yt={name:"Date",components:{Main:tt},props:["date"],data:function(){return{refresh:!0}},computed:{ts:function(){return w.fromISODate(this.date)}},watch:{$route:function(){var t=this;this.refresh=!1,this.$nextTick((function(){t.refresh=!0}))}}},Ot=yt,_t=(n("b40f"),Object(l["a"])(Ot,bt,wt,!1,null,"3b96564e",null)),kt=_t.exports;r["a"].use(h["a"]);var jt=[{path:"/",name:"Home",component:gt},{path:"/:date(\\d{4}-\\d{2}-\\d{2})",name:"Date",component:kt,props:!0}],Dt=new h["a"]({mode:"hash",base:"",routes:jt}),xt=Dt,Rt=n("d4ec"),St=n("bee2"),Ct=(n("b0c0"),n("159b"),n("4e82"),"orga"),Mt=1,Tt=function(){function t(){Object(Rt["a"])(this,t),this.afterOpened=[],this.opening=!1}return Object(St["a"])(t,[{key:"openDB",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,n,r,a,i,o=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(this.db&&this.db instanceof IDBDatabase)){t.next=2;break}return t.abrupt("return",!0);case 2:if(e=new Promise((function(t){o.afterOpened.push(t)})),this.opening){t.next=17;break}return this.opening=!0,n=!1,t.next=8,new Promise((function(t){var e=indexedDB.open(Ct,Mt);e.onupgradeneeded=function(t){n=!0;var e=t.target.result;e.createObjectStore("diary",{keyPath:"date"}),e.createObjectStore("monthly",{keyPath:"month"}),e.createObjectStore("states")},e.onsuccess=function(){console.log("Use IndexedDB:",e.result.name,"version:",e.result.version),t(e.result)},e.onerror=function(){console.warn("IndexedDB could not be initialized"),t(null)}}));case 8:if(r=t.sent,a=!0,this.db=r,!r||!n){t.next=15;break}return t.next=14,this.initDB(this.db);case 14:a=t.sent;case 15:i=r&&a,this.afterOpened.forEach((function(t){t(i)}));case 17:return t.abrupt("return",e);case 18:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"initDB",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e&&e instanceof IDBDatabase){t.next=2;break}throw new TypeError("expect IDBDatabase");case 2:n=e.transaction("states","readwrite").objectStore("states"),n.add("orga","name"),n.add(0,"balance"),n.add(0,"updateAt");case 6:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"add",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n){var r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){if(!(r.db instanceof IDBDatabase))return t(!1);var a=r.db.transaction(e,"readwrite").objectStore(e).add(n);a.onsuccess=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t(!0);case 1:case"end":return e.stop()}}),e)}))),a.onerror=function(){t(!1)}})));case 1:case"end":return t.stop()}}),t)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"set",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n,r){var a=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){if(!(a.db instanceof IDBDatabase))return t(!1);var i=a.db.transaction(e,"readwrite").objectStore(e).put(n,r);i.onsuccess=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t(!0);case 1:case"end":return e.stop()}}),e)}))),i.onerror=function(){t(!1)}})));case 1:case"end":return t.stop()}}),t)})));function e(e,n,r){return t.apply(this,arguments)}return e}()},{key:"get",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e,n){var r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){if(!(r.db instanceof IDBDatabase))return t(null);var a=r.db.transaction(e,"readonly").objectStore(e).get(n);a.onsuccess=function(e){t(e.target.result)},a.onerror=function(){t(null)}})));case 1:case"end":return t.stop()}}),t)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"getTotalRewards",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:Date.now(),t.abrupt("return",new Promise((function(t){if(!(n.db instanceof IDBDatabase))return t(NaN);var r=n.db.transaction("diary","readonly").objectStore("diary").getAll(IDBKeyRange.bound(w.firstDateOfMonth(e).date,w.lastDateOfMonth(e).date));r.onsuccess=function(e){var n=e.target.result,r=n.reduce((function(t,e){return t+(e.rewards||0)}),0);t(r)},r.onerror=function(){t(NaN)}})));case 2:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getMonthlyInfo",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,n=this,r=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:Date.now(),t.abrupt("return",new Promise((function(t){if(!(n.db instanceof IDBDatabase))return t(NaN);var r=w.firstDateOfMonth(e).date,a=w.lastDateOfMonth(e).date,i=n.db.transaction("diary","readonly").objectStore("diary").getAll(IDBKeyRange.bound(r,a));i.onsuccess=function(e){for(var n=e.target.result.sort((function(t,e){return t.date-e.date})),i=0,o=[],s=r;s<=a;s++){var u;(null===(u=n[i])||void 0===u?void 0:u.date)===s?(o.push(n[i]),i++):o.push({date:s,dateStr:w.dateToString(s),isEmpty:!0})}t(o)},i.onerror=function(){t([])}})));case 2:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()}]),t}();r["a"].use(u["a"]);var Pt=new u["a"].Store({state:{db:new Tt},mutations:{},actions:{OPEN_DB:function(t){var e=t.state;return e.db.openDB()}},modules:{}});r["a"].config.productionTip=!1,new r["a"]({router:xt,store:Pt,render:function(t){return t(p)}}).$mount("#app")},5940:function(t,e,n){},6057:function(t,e,n){"use strict";n("f45e")},"62c8":function(t,e,n){"use strict";n("5940")},7240:function(t,e,n){"use strict";n("54b1")},"7faf":function(t,e,n){"use strict";n("b8ff")},"8b3f":function(t,e,n){},aaf5:function(t,e,n){},b40f:function(t,e,n){"use strict";n("0e20")},b8ff:function(t,e,n){},c064:function(t,e,n){"use strict";n("aaf5")},c219:function(t,e,n){"use strict";n("4fc1")},eec8:function(t,e,n){"use strict";n("f734")},f45e:function(t,e,n){},f734:function(t,e,n){}});
//# sourceMappingURL=app.f09daa1c.js.map